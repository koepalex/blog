<!doctype html><html lang=de-de><head><title>UnauthorizedAccessException beim Kopieren einer Datei // Blog von Alexander Köpke</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.111.3"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Alexander Köpke"><meta name=description content><link rel=stylesheet href=/blog/css/main.min.ead1f6492242b7d93618e6840b25260f8ea1ca68dc04cc9cf1b88adcb996693b.css><meta name=twitter:card content="summary"><meta name=twitter:title content="UnauthorizedAccessException beim Kopieren einer Datei"><meta name=twitter:description content="Kopieren, verschieben, umbenennen und löschen von Dateien gehören zu häufigen Aufgaben eines Softwareentwicklers. In diesem Beitrag sollen ein paar Dinge aufgezeigt werden die einem beim kopieren von Datein vielleicht nicht bewusst sind. Wie kopiert man jetzt am besten eine Datei? Eine Variante ist die statische Methode der Klasse File:
File.Copy(@“C:\input\test.bmp“, @“C:\output\test.bmp“, true);
Damit man sich Überprüfungen wie ob die Datei bereits existiert (File.Exist()) sparen kann, wird die Überladung der Copy-Methode verwendet, welche bestehende Dateien überschreibt."><meta property="og:title" content="UnauthorizedAccessException beim Kopieren einer Datei"><meta property="og:description" content="Kopieren, verschieben, umbenennen und löschen von Dateien gehören zu häufigen Aufgaben eines Softwareentwicklers. In diesem Beitrag sollen ein paar Dinge aufgezeigt werden die einem beim kopieren von Datein vielleicht nicht bewusst sind. Wie kopiert man jetzt am besten eine Datei? Eine Variante ist die statische Methode der Klasse File:
File.Copy(@“C:\input\test.bmp“, @“C:\output\test.bmp“, true);
Damit man sich Überprüfungen wie ob die Datei bereits existiert (File.Exist()) sparen kann, wird die Überladung der Copy-Methode verwendet, welche bestehende Dateien überschreibt."><meta property="og:type" content="article"><meta property="og:url" content="https://koepalex.github.io/blog/blog/2011-11-07-unauthorizedaccessexception-beim-kopieren-einer-datei/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2011-11-07T00:00:00+00:00"><meta property="article:modified_time" content="2011-11-07T00:00:00+00:00"></head><body><header class=app-header><a href=https://koepalex.github.io/blog/><img class=app-header-avatar src=/blog/avatar.jpg alt="Alexander Köpke"></a>
<span class=app-header-title>Blog von Alexander Köpke</span><p>Technischer Artikel, das Universum und der ganze Rest</p><div class=app-header-social><a href=https://github.com/koepalex target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>GitHub</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://twitter.com/koepalex target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>Twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>UnauthorizedAccessException beim Kopieren einer Datei</h1><div class=post-meta><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Nov 7, 2011</div><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>2 min read</div><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg><a class=tag href=https://koepalex.github.io/blog/tags/datei/>datei</a>
<a class=tag href=https://koepalex.github.io/blog/tags/exception/>exception</a>
<a class=tag href=https://koepalex.github.io/blog/tags/kopieren/>kopieren</a>
<a class=tag href=https://koepalex.github.io/blog/tags/unauthorizedaccess/>unauthorizedaccess</a></div></div></header><div class=post-content><p>Kopieren, verschieben, umbenennen und löschen von Dateien gehören zu häufigen Aufgaben eines Softwareentwicklers. In diesem Beitrag sollen ein paar Dinge aufgezeigt werden die einem beim kopieren von Datein vielleicht nicht bewusst sind. Wie kopiert man jetzt am besten eine Datei? Eine Variante ist die statische Methode der Klasse File:</p><p>File.Copy(@“C:\input\test.bmp“, @“C:\output\test.bmp“, true);</p><p>Damit man sich Überprüfungen wie ob die Datei bereits existiert (File.Exist()) sparen kann, wird die Überladung der Copy-Methode verwendet, welche bestehende Dateien überschreibt. Solange man die Software nur mit administrativen Rechten betreibt, hat man alles richtig gemacht. Muss die Software auch mit Benutzer Rechten arbeiten, kann man hier eine UnauthorizedAccessException bekommen. Dies würde zum Beispiel eintreten wenn eine schreibgeschützte Datei, bereits im Zielverzeichnis existiert und erneut in dieses Verzeichnis kopiert werden soll. Die .Net Implementierung der Copy-Methode fordert Berechtigungen on demand an, das bedeutet erst, wenn besondere Zugriffsrechte benötigt werden, werden diese angefordert. Als Benutzer hat man aber nicht die benötigten Rechte um schreibgeschützte Dateien zu überschreiben. Um diesen speziellen Fall zu lösen, könnte man nach dem kopieren die Attribute der Datei verändern (dafür genügen die Benutzer Rechte):</p><p>const string path = @&ldquo;C:\output\test.bmp&rdquo;;<br>FileAttributes attr = File.GetAttributes(path);<br>if ((attr & FileAttributes.ReadOnly) == FileAttributes.ReadOnly)<br>{
attr &= (~FileAttributes.ReadOnly);
File.SetAttributes(path, attr); }</p><p>Oder man schreibt die Datei nur, wenn sie nicht bereits in dem Zielverzeichnis existiert. Eine andere Möglichkeit ist es sowohl die Quelldatei als auch die Zieldatei als FileStream zu laden, und anschließend nur den Inhalt zu übernehmen. Dadurch fallen eventuelle zusätzliche Attribute (oder Alternative NTFS-Dateiströme <a href=http://de.wikipedia.org/wiki/Alternativer_Datenstrom>http://de.wikipedia.org/wiki/Alternativer_Datenstrom</a> ) weg. Damit solche Fehler nicht erst beim Einsatz der Software auftreten, empfiehlt es sich entsprechende Unit-Tests unter Benutzer-Rechten laufen zulassen. Als Tipp sei noch das Programm Process Monitor (ehemals FileMon & Regmon) genannt. Es zeichnet Zugriffe auf das Dateisystem, die Registrierung und mehr mit vielen zusätzlichen Informationen (wie Dateiattribute) auf. Weitere Informationen finden Sie auf der Seite: <a href=http://technet.microsoft.com/en-us/sysinternals/bb896645>http://technet.microsoft.com/en-us/sysinternals/bb896645</a></p></div><div class=post-footer></div></article></main></body></html>