<!doctype html><html lang=de-de><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content><meta property="og:type" content="article"><meta property="og:image" content="https://www.alexander-koepke.de//koepalex.logo.gif"><meta property="twitter:image" content="https://www.alexander-koepke.de//koepalex.logo.gif"><meta name=title content="Running OPC UA server simulation in dotnet aspire"><meta property="og:title" content="Running OPC UA server simulation in dotnet aspire"><meta property="twitter:title" content="Running OPC UA server simulation in dotnet aspire"><meta name=description content="Technical articles, the Universe and the all the rest"><meta property="og:description" content="Technical articles, the Universe and the all the rest"><meta property="twitter:description" content="Technical articles, the Universe and the all the rest"><meta property="twitter:card" content="summary"><meta name=keyword content><link rel="shortcut icon" href=/img/favicon.ico><title>Running OPC UA server simulation in dotnet aspire |</title><link rel=canonical href=/post/2025-05-07_opcplc_aspire/><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.css><link rel=stylesheet href=/css/font-awesome.all.min.css><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/hux-blog.min.js></script><script src=/js/lazysizes.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=/></a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/categories/ai/ml/>ai/ml</a></li><li><a href=/categories/dotnet/>dotnet</a></li><li><a href=/categories/miscellaneous/>miscellaneous</a></li><li><a href=/categories/opc-ua/>opc ua</a></li><li><a href=/categories/til/>til</a></li><li><a href=/about//>ABOUT</a></li><li><a href=/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><header class=intro-header style=background-image:url(/koepalex.logo.gif)><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=site-heading><h1></h1><span class=subheading></span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-1
col-md-8 col-md-offset-1
col-sm-12
col-xs-12
post-container"><h1 id=simulating-an-opc-ua-server-with-net-aspire-and-opc-plc>Simulating an OPC UA Server with .NET Aspire and OPC PLC</h1><p>Deploying an OPC UA server simulation is a common need during development and testing of industrial IoT applications.
Recently, a customer asked how to set up such a simulation using <strong>.NET Aspire</strong>, in order to streamline development
workflows and easily monitor system components, logs, metrics, and inter-service communication.</p><p>.NET Aspire provides an ideal environment for orchestrating microservices and dependencies, making it a great fit for
hosting a simulated OPC UA server. For the server simulation, I use the free and open-source
<a href=https://github.com/Azure-Samples/iot-edge-opc-plc>OPC PLC</a> provided by Microsoft. While it&rsquo;s possible to run the
server from source, I prefer using the containerized version published on the Microsoft Container Registry (MCR),
which integrates more easily into an Aspire-based solution.</p><hr><h2 id=integrating-opc-plc-with-net-aspire>Integrating OPC PLC with .NET Aspire</h2><p>In a .NET Aspire AppHost project, we can add the OPC PLC container as a reference, define its endpoint, and configure
all necessary startup parameters through container arguments.</p><p>Hereâ€™s how to set it up:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#8be9fd>var</span> port = <span style=color:#bd93f9>50000</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd>var</span> numberOfSlowNodes = <span style=color:#bd93f9>50</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd>var</span> numberOfFastNodes = <span style=color:#bd93f9>50</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd>var</span> aspireOtelEndpoint = <span style=color:#f1fa8c>&#34;https://localhost:21222&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>var</span> opcplc = builder
</span></span><span style=display:flex><span>    .AddContainer(<span style=color:#f1fa8c>&#34;opcplc&#34;</span>, <span style=color:#f1fa8c>&#34;mcr.microsoft.com/iotedge/opc-plc&#34;</span>, <span style=color:#f1fa8c>&#34;2.12.32&#34;</span>)
</span></span><span style=display:flex><span>    .WithEndpoint(port: port, targetPort: port, scheme: <span style=color:#f1fa8c>&#34;opc.tcp&#34;</span>, name: <span style=color:#f1fa8c>&#34;default&#34;</span>)
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>&#34;--ph=opcplc&#34;</span>)                           <span style=color:#6272a4>// Hostname for OPC PLC</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>&#34;--cdn=opcplc&#34;</span>)                          <span style=color:#6272a4>// Additional hostnames or IPs for the certificate</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>&#34;--autoaccept&#34;</span>)                          <span style=color:#6272a4>// Auto-accept all certificates</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>$&#34;--sn={numberOfSlowNodes}&#34;</span>)             <span style=color:#6272a4>// Number of slow-changing nodes</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>&#34;--sr=10&#34;</span>)                               <span style=color:#6272a4>// Slow node update rate (10s)</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>$&#34;--fn={numberOfFastNodes}&#34;</span>)             <span style=color:#6272a4>// Number of fast-changing nodes</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>&#34;--veryfastrate=1000&#34;</span>)                   <span style=color:#6272a4>// Fast node update rate (1s)</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>&#34;--gn=5&#34;</span>)                                <span style=color:#6272a4>// Number of deterministic GUID nodes</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>$&#34;--pn={port}&#34;</span>)                          <span style=color:#6272a4>// Server port</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>&#34;--maxsessioncount=100&#34;</span>)                 <span style=color:#6272a4>// Max session count</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>&#34;--maxsubscriptioncount=100&#34;</span>)            <span style=color:#6272a4>// Max subscriptions</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>&#34;--maxqueuedrequestcount=2000&#34;</span>)          <span style=color:#6272a4>// Max queued requests</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>&#34;--ses&#34;</span>)                                 <span style=color:#6272a4>// Simulate simple events</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>&#34;--alm&#34;</span>)                                 <span style=color:#6272a4>// Simulate alarms</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>&#34;--at=FlatDirectory&#34;</span>)                    <span style=color:#6272a4>// Use flat directory for certs</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>&#34;--drurs&#34;</span>)                               <span style=color:#6272a4>// Don&#39;t reject unknown revocation status</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>$&#34;--otlpee={aspireOtelEndpoint}&#34;</span>)        <span style=color:#6272a4>// OpenTelemetry endpoint for Aspire</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>&#34;--otlpei=60&#34;</span>)                           <span style=color:#6272a4>// OTEL export interval (seconds)</span>
</span></span><span style=display:flex><span>    .WithArgs(<span style=color:#f1fa8c>&#34;--otlpep=grpc&#34;</span>);                        <span style=color:#6272a4>// OTEL export protocol</span>
</span></span></code></pre></div><hr><h2 id=connecting-the-client-application>Connecting the Client Application</h2><p>To consume the OPC UA server from another application within the Aspire AppHost, you need to retrieve the endpoint
and use <code>.WithReference()</code> to wire it up:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#8be9fd>var</span> opcplcEndpoint = opcplc.GetEndpoint(<span style=color:#f1fa8c>&#34;default&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>var</span> myApp = builder
</span></span><span style=display:flex><span>    .AddProject&lt;Projects.MyOpcUaClientApplication&gt;(<span style=color:#f1fa8c>&#34;app&#34;</span>)
</span></span><span style=display:flex><span>    .WithReference(opcplcEndpoint);
</span></span></code></pre></div><p>Under the hood, <code>.WithReference()</code> injects the endpoint into the target application via an environment variable. The
format is <code>services__{sourceResourceName}__{endpointName}__{endpointIndex}</code> Since the <code>scheme</code> (e.g., <code>opc.tcp</code>) is not
valid in environment variable names, we provide a friendly name (<code>"default"</code>) when defining the endpoint earlier.
In this example, the resulting environment variable will be <code>services_opcplc_default_0</code> and it will contain the endpoint
value <code>opc.tcp://localhost:50000</code>. Your client application can then read this variable to dynamically connect to the
simulated OPC UA server.</p><hr><p>This approach allows you to simulate a realistic industrial setup with configurable node behavior and integrate
telemetry and monitoring through OpenTelemetry, all while staying within the developer-friendly .NET Aspire ecosystem.</p></div><div class="col-lg-3 col-lg-offset-0
col-md-3 col-md-offset-0
col-sm-12
col-xs-12
sidebar-container"><section class="visible-md visible-lg"><div class=short-about><a href=/about><img src=/avatar.jpg alt=avatar style=cursor:pointer></a><p>Software Architect in the Agile Age, with focus on Industrial IoT</p><ul class=list-inline><li><a href=mailto:this-is@alexander-koepke.de><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fa fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/alexander-k%c3%b6pke-3222a21b7/><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/9474615/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=@koepalex@dotnet.social><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-mastodon fa-stack-1x fa-inverse"></i></span></a></li></ul></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=mailto:this-is@alexander-koepke.de><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/alexander-k%c3%b6pke-3222a21b7/><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/9474615/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=@koepalex@dotnet.social><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-mastodon fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; 2025<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>