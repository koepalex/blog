<!doctype html><html lang=de-de><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content><meta property="og:type" content="article"><meta property="og:image" content="https://www.alexander-koepke.de//koepalex.logo.gif"><meta property="twitter:image" content="https://www.alexander-koepke.de//koepalex.logo.gif"><meta name=title content="Debugging von Performance Problemen in .NET"><meta property="og:title" content="Debugging von Performance Problemen in .NET"><meta property="twitter:title" content="Debugging von Performance Problemen in .NET"><meta name=description content="Technical articles, the Universe and the all the rest"><meta property="og:description" content="Technical articles, the Universe and the all the rest"><meta property="twitter:description" content="Technical articles, the Universe and the all the rest"><meta property="twitter:card" content="summary"><meta name=keyword content><link rel="shortcut icon" href=/img/favicon.ico><title>Debugging von Performance Problemen in .NET | </title><link rel=canonical href=/post/2013-11-27-debugging-von-performance-problemen-in-net/><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.css><link rel=stylesheet href=/css/font-awesome.all.min.css><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/hux-blog.min.js></script><script src=/js/lazysizes.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=/></a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/categories/dotnet/>dotnet</a></li><li><a href=/categories/miscellaneous/>miscellaneous</a></li><li><a href=/categories/opc-ua/>opc ua</a></li><li><a href=/categories/til/>til</a></li><li><a href=/about//>ABOUT</a></li><li><a href=/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/koepalex.logo.gif)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/dotnet title=dotnet>dotnet
</a><a class=tag href=/tags/perfvew title=perfvew>perfvew
</a><a class=tag href=/tags/sos title=sos>sos
</a><a class=tag href=/tags/sosex title=sosex>sosex
</a><a class=tag href=/tags/windbg title=windbg>windbg</a></div><h1>Debugging von Performance Problemen in .NET</h1><h2 class=subheading></h2><span class=meta>Posted by
on
Wednesday, November 27, 2013</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>Die Analyse von Speicherproblemen ist eine Aufgabe die bei großen .NET Anwendungen häufiger vorkommt. In C++ wurde gesucht, wer welche Speicherblöcke angefordert und nicht wieder freigegeben hat und im .NET Umfeld wird eben gesucht warum der Gabarge-Collector den Speicher nicht freigeben kann. Oder man sucht warum einige Benutzeraktionen besonders lange benötigen. Für die Analyse gibt es eine ganze Reihe guter kommerzieller Programme, auf diese möchte ich jedoch nicht eingehen, sondern ein paar kostenlosen Alternativen vorstellen.</p><h3 id=perfviewhttpwwwmicrosoftcomen-usdownloaddetailsaspxid28567><a href="http://www.microsoft.com/en-us/download/details.aspx?id=28567">PerfView</a></h3><p>Dieses Programm von Microsoft ist klein, schnell und leistungsfähig. Zum einen bietet es die Möglichkeit mittels ETW (Event Tracing for Windows) Problemen in der Laufzeit (CPU, I/O, GC) auf die Spur zu kommen. Zum anderen kann es Speicherabbilder von Programmen erzeugen und diese <strong>Vergleichen</strong>! Ausführliche Informationen gibt es bei <a href=http://channel9.msdn.com/Series/PerfView-Tutorial>Channel9</a> oder auf <a href=http://blogs.msdn.com/b/vancem/>Vance Morrison’s Webblog</a>.</p><h3 id=windbghttpmsdnmicrosoftcomen-uslibrarywindowshardwareff551063aspx-mit-_s_on-_o_f-_s_trikes-erweiterung><a href=http://msdn.microsoft.com/en-us/library/windows/hardware/ff551063.aspx>WinDbg</a> mit „_S_on _O_f _S_trikes“ Erweiterung</h3><p>Microsoft liefert die sos.dll mit dem .NET Framework aus. Sie ermöglicht den WinDbg dazu managed Code zu debuggen. Für die den Themenkomplex <em>WinDbg und SOS</em>, gibt es viele gute Artikel/Tutorials von welchen ich zwei empfehlen möchte:</p><ol><li>Der Blog von <a href="http://blogs.msdn.com/b/tess/default.aspx?PageIndex=1&amp;PostSortBy=MostRecent">Tess Ferrandez</a> beispielsweise mit den Artikeln „<a href=http://blogs.msdn.com/b/tess/archive/2007/10/19/net-finalizer-memory-leak-debugging-with-sos-dll-in-visual-studio.aspx>.NET Finalizer Memory Leak</a>“ und „<a href="http://blogs.msdn.com/b/tess/archive/2010/03/01/new-commands-in-sos-for-net-4-0-part-1.aspx?Redirected=true">New commands in SOS for 4.0</a>“.</li><li>Ein <a href=http://blogs.msdn.com/b/rextang/archive/2007/07/24/4026494.aspx>Blogeintrag von Rex Tang</a> in welchem er weitere lesenswerte Artikel zu diesem Thema auflistet.</li></ol><p>Auf der MSDN Webseite befindet sich die <a href=http://msdn.microsoft.com/de-de/library/bb190764.aspx>Befehlsreferenz</a>.</p><h3 id=windbg-mit-sosex-tensionhttpwwwstevestechspotcom-erweiterung>WinDbg mit „<a href=http://www.stevestechspot.com>SOSEX tension</a>“ Erweiterung</h3><p>Die von Steve Johnson geschriebene sosex.dll bietet viele nützliche Erweiterungen die dass managed Code debugging im WinDbg deutlich vereinfachen. Beispielsweise kann die SOSEX mittels Befehl <code>!bhi</code> einen HeapIndex erstellen lassen. Dieser Index enthält alle benötigten Informationen über die Objekte auf dem Heap. Um anschließend z.B. alle GC-Roots eines Objektes zu finden (<code>!mroot &lt;adr> -all</code>) muss die SOSEX nicht das gesamte Speicherabbild analysieren sondern nur den HeapIndex. Dieses Vorgehen funktioniert deutlich schneller als die Alternative der SOS (<code>!gcroot -all &lt;adr></code>), welche jedes mal das Speicherabbild durchsucht.</p><p>Eine andere Eigenschaft ist das die SOSEX <a href=http://www.wintellect.com/blogs/jrobbins/a-cool-windbg-sos-hidden-feature>.prefer_dml 1</a> verwendet d.h. dass Links in die Ausgabe des WinDbg eingebettet werden. Dadurch wird einem häufig das kopieren bzw. abtippen von teilen der Ausgabe erspart.</p><p>Weitere Funktionalitäten der SOSEX sind</p><ul><li>Anzeige von managed Locks und native CriticalSections (<code>!mlocks</code>)</li><li>Anzeige von wartenden Thread inkl. dem worauf sie warten (<code>!mwaits</code>)</li><li>Anzeige von Objekten in der Finalizer Queue (<code>!finq</code>)</li><li>Anzeige von Objekten in der F-Reachable Queue (<code>!frq</code>)</li></ul><p><em>Lesen sie <a href=http://blogs.microsoft.co.il/sasha/2012/07/28/finalization-queue-or-f-reachable-queue-sosex-not-so-new-commands/>hier</a> die Beschreibung des Unterschiedes zwischen Finalizer Queue und F-Reachable Quere.</em></p><p>Tip: Herr Johnson aktualisiert SOSEX regelmäßig, auch wenn er dazu keine Notiz auf seinen Blog hinterlässt. Deshalb lohnt es sich immer mal wieder das Zip-Archiv herunter zuladen und zu prüfen ob die enthaltene SOSEX neuer ist als die eigene.</p><hr><ul class=pager><li class=previous><a href=/post/2013-10-21-neues-vom-gc-in-net-4-0-und-4-5/ data-toggle=tooltip data-placement=top title="Neues vom GC in .NET 4.0 und 4.5">&larr;
Previous Post</a></li><li class=next><a href=/post/2014-01-05-autohotkey/ data-toggle=tooltip data-placement=top title=AutoHotkey>Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=mailto:this-is@alexander-koepke.de><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/alexander-k%c3%b6pke-3222a21b7/><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/9474615/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=@koepalex@dotnet.social><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-mastodon fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; 2024<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>