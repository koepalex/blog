<!doctype html><html lang=de-de><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content><meta property="og:type" content="article"><meta property="og:image" content="https://alexander-koepke.de/blog//koepalex.logo.gif"><meta property="twitter:image" content="https://alexander-koepke.de/blog//koepalex.logo.gif"><meta name=title content="Vermeidung von switch-case zur Typen Bestimmung beim Aufruf von generischen Methoden"><meta property="og:title" content="Vermeidung von switch-case zur Typen Bestimmung beim Aufruf von generischen Methoden"><meta property="twitter:title" content="Vermeidung von switch-case zur Typen Bestimmung beim Aufruf von generischen Methoden"><meta name=description content="Technical articles, the Universe and the all the rest"><meta property="og:description" content="Technical articles, the Universe and the all the rest"><meta property="twitter:description" content="Technical articles, the Universe and the all the rest"><meta property="twitter:card" content="summary"><meta name=keyword content><link rel="shortcut icon" href=/blog/img/favicon.ico><title>Vermeidung von switch-case zur Typen Bestimmung beim Aufruf von generischen Methoden | </title><link rel=canonical href=/blog/post/2012-04-20-vermeidung-von-switch-case-zur-typen-bestimmung-beim-aufruf-von-generischen-methoden-3/><link rel=stylesheet href=/blog/css/bootstrap.min.css><link rel=stylesheet href=/blog/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/blog/css/zanshang.css><link rel=stylesheet href=/blog/css/font-awesome.all.min.css><script src=/blog/js/jquery.min.js></script><script src=/blog/js/bootstrap.min.js></script><script src=/blog/js/hux-blog.min.js></script><script src=/blog/js/lazysizes.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=/></a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/blog>All Posts</a></li><li><a href=/blog/categories/dotnet/>dotnet</a></li><li><a href=/blog/categories/miscellaneous/>miscellaneous</a></li><li><a href=/blog/about//>ABOUT</a></li><li><a href=/blog/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/blog/koepalex.logo.gif)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/dotnet title=dotnet>dotnet
</a><a class=tag href=/tags/case title=case>case
</a><a class=tag href=/tags/cast title=cast>cast
</a><a class=tag href=/tags/generic title=generic>generic
</a><a class=tag href=/tags/reflection title=reflection>reflection
</a><a class=tag href=/tags/switch title=switch>switch
</a><a class=tag href=/tags/type title=type>type</a></div><h1>Vermeidung von switch-case zur Typen Bestimmung beim Aufruf von generischen Methoden</h1><h2 class=subheading></h2><span class=meta>Posted by
on
Friday, April 20, 2012</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>In der Entwicklung mit .NET hat man öfter folgendes Problem:</p><p>Methoden sind generisch implementiert und zu verwendende Objekte sind nur in Form von Referenzen auf Basistypen vorhanden (z.B. System.Array, System.Object). Diese Referenzen können nicht direkt an generische Methode übergeben werden (ergibt einen Compile Fehler).</p><p>Häufig liegen daher Typinformationen als String vor (über FullName-Property, aus Konfigurationsdatei, …). Diese Informationen werden anschließend verwendet, um den Typ der Referenz über switch-case aufzulösen.</p><p>Zum Beispiel:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#ff79c6>void</span> Foo (Array array)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>var</span> type = array.GetType();
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>switch</span> (type.FullName)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;System.Boolean[]&#34;</span> :
</span></span><span style=display:flex><span>            <span style=color:#8be9fd>var</span> result = Bar((<span style=color:#8be9fd>bool</span>[]) array);
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;System.Int32[]&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#8be9fd>var</span> result = Bar((<span style=color:#8be9fd>int</span>[]) array);
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;System.String[]&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#8be9fd>var</span> result = Bar((<span style=color:#8be9fd>string</span>[]) array);
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;my.KnownType[]&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#8be9fd>var</span> result = Bar((KnownType[]) array);
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;other.SecondKnownType[]&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#8be9fd>var</span> result = Bar((SecondKnownType[]) array);
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;different.ThirdKnownType[]&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#8be9fd>var</span> result = Bar((ThirdKnownType[]) array);
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#6272a4>//...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#6272a4>//do something</span>
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#8be9fd;font-style:italic>public</span> T Bar&lt;T&gt;(T[] elements)
</span></span><span style=display:flex><span> {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>//do something</span>
</span></span><span style=display:flex><span> }
</span></span></code></pre></div><p>Außer, dass der Quelltext davon aufgebläht wird, funktioniert die Methode nur mit vorher bekannten Typen. Eine Alternative dazu ist die Benutzung von Reflection:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#ff79c6>void</span> Foo (Array array)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>var</span> type = array.GetType();
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>var</span> methodInfo = GetType().GetMethod(<span style=color:#f1fa8c>&#34;Bar&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>var</span> genericMethodInfo = methodInfo.MakeGenericMethod(type.GetElementType());
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>var</span> result = genericMethodInfo.Invoke(<span style=color:#ff79c6>this</span>, <span style=color:#ff79c6>new</span> <span style=color:#8be9fd>object</span>[] {array});
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Im Falle von ref, bzw. out Parametern, bei denen eine konkrete Instanz gebraucht wird, kann diese über Activator.CreateInstance(), bzw. Array.CreateInstance() erstellt werden.</p><hr><ul class=pager><li class=previous><a href=/blog/post/2011-11-07-unauthorizedaccessexception-beim-kopieren-einer-datei/ data-toggle=tooltip data-placement=top title="UnauthorizedAccessException beim Kopieren einer Datei">&larr;
Previous Post</a></li><li class=next><a href=/blog/post/2012-06-08-inversion-of-control-container-service-locator-und-dependency-injection/ data-toggle=tooltip data-placement=top title="Inversion Of Control(-Container), Service Locator und Dependency Injection">Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=mailto:this-is@alexander-koepke.de><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/alexander-k%c3%b6pke-3222a21b7/><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/9474615/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=@koepalex@dotnet.social><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-mastodon fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; 2024<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/blog/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>