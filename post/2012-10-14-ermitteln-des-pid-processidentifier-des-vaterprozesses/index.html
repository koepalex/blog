<!doctype html><html lang=de-de><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content><meta property="og:type" content="article"><meta property="og:image" content="https://koepalex.github.io/blog//koepalex.logo.gif"><meta property="twitter:image" content="https://koepalex.github.io/blog//koepalex.logo.gif"><meta name=title content="Ermitteln des PID (Processidentifier) des Vaterprozesses"><meta property="og:title" content="Ermitteln des PID (Processidentifier) des Vaterprozesses"><meta property="twitter:title" content="Ermitteln des PID (Processidentifier) des Vaterprozesses"><meta name=description content="Technischer Artikel, das Universum und der ganze Rest"><meta property="og:description" content="Technischer Artikel, das Universum und der ganze Rest"><meta property="twitter:description" content="Technischer Artikel, das Universum und der ganze Rest"><meta property="twitter:card" content="summary"><meta name=keyword content><link rel="shortcut icon" href=/blog/img/favicon.ico><title>Ermitteln des PID (Processidentifier) des Vaterprozesses | </title><link rel=canonical href=/blog/post/2012-10-14-ermitteln-des-pid-processidentifier-des-vaterprozesses/><link rel=stylesheet href=/blog/css/bootstrap.min.css><link rel=stylesheet href=/blog/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/blog/css/zanshang.css><link rel=stylesheet href=/blog/css/font-awesome.all.min.css><script src=/blog/js/jquery.min.js></script><script src=/blog/js/bootstrap.min.js></script><script src=/blog/js/hux-blog.min.js></script><script src=/blog/js/lazysizes.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=/></a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/blog>All Posts</a></li><li><a href=/blog/categories/allgemein/>allgemein</a></li><li><a href=/blog/categories/c-net/>c-net</a></li><li><a href=/blog/categories/java/>java</a></li><li><a href=/blog/categories/macos/>macos</a></li><li><a href=/blog/categories/ubuntu/>ubuntu</a></li><li><a href=/blog/categories/zfs/>zfs</a></li><li><a href=/blog/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/blog/koepalex.logo.gif)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/ntdll title=ntdll>ntdll
</a><a class=tag href=/tags/parent title=parent>parent
</a><a class=tag href=/tags/performancecounter title=performancecounter>performancecounter
</a><a class=tag href=/tags/pid title=pid>pid
</a><a class=tag href=/tags/wmi title=wmi>wmi</a></div><h1>Ermitteln des PID (Processidentifier) des Vaterprozesses</h1><h2 class=subheading></h2><span class=meta>Posted by
on
Sunday, October 14, 2012</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>In manchen Fällen ist es notwendig heraus zu finden, welches der Vaterprozess eines Prozesses ist. Dafür gibt es im Allgemeinen drei verschiedene Lösungen im Windows .NET Umfeld.</p><p>Die häufigste Lösung ist die Verwendung von <strong>Performancecountern</strong>.</p><blockquote><p>var process = FindProcess();<br>using (var pC = new PerformanceCounter(</p><p>    &ldquo;Process&rdquo;,<br>    &ldquo;Creating Process ID&rdquo;,<br>    string.Format("{0}#{1}", process.ProcessName, 1),  <br>    process.MachineName))<br>{<br>       int pid = (int)pC.NextValue();<br>       Console.WriteLine(&ldquo;parent pid = {0}&rdquo;, pid);<br>}</p></blockquote><p>Die Verwendung von Performancecountern im Allgemeinen kann zwei mögliche Nachteile haben:</p><ol><li>Vor Windows Vista war es ausreichend, dass der Account des Benutzers lokale Administratorrechte besitzt, um Performancecounter zu nutzen. Seit Windows Vista, muss der Account zusätzlich Mitglied in der Gruppe &ldquo;Performance Monitor Users&rdquo; sein oder der Programmierer muss mittels UAC (User Account Control) zur Laufzeit die entsprechenden Rechte beantragen.</li><li>Performancecounter funktionieren im wesentlichen dadurch, dass ihre Werte über die Registry abgefragt werden können. Auch werden alle Performancecounter über die Registry bekannt gegeben, somit ist eine Nutzung aus unterschiedlichen Programmen möglich (vgl. <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa371643%28v=vs.85%29.aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/aa371643(v=vs.85).aspx</a>). Die Registry kann in verschiedenen Fällen jedoch korrumpiert werden, dies führt zu einer &ldquo;System.FormatException&rdquo; beim anlegen eines Performancecounters.  Es ist natürlich ohne weiteres Möglich die Exception zu fangen, jedoch wird man den Wert des Performancecounters nicht bekommen. Auf der Microsoft Support Webseite findet sich eine Anleitung um die Registry manuell zu reparieren (<a href=http://support.microsoft.com/kb/300956>http://support.microsoft.com/kb/300956</a>).</li></ol><p>Eine zweite Lösung ist mittels <strong>P/Invoke die Windows Systembibliothek &ldquo;ntdll.dll&rdquo;</strong> anzusprechen. Über die Methode NtQueryInformationProcess kann man Zugriff auf ein PROCESS_BASIC_INFORMATION-Struktur erlangen. Das Element InheritedFromUniqueProcessId liefert anschließend die gewünschte PID. Eine Beispielimplementierung ist zu finden unter <a href=http://www.pinvoke.net/default.aspx/ntdll.ntqueryinformationprocess>http://www.pinvoke.net/default.aspx/ntdll.ntqueryinformationprocess</a>.</p><p>Von der Verwendung der Methode ist jedoch aus heutiger Sicht abzuraten, da Microsoft im entsprechenden Developer Network Artikel darauf hinweist, dass diese in Zukunft modifiziert oder nicht mehr verfügbar sein wird (vgl. <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms684280(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/ms684280(v=vs.85).aspx</a>).</p><p>Die (von mir) empfohlene Variante ist die Verwendung der <strong>Windows Management Instrumentation</strong> (kurz WMI, vgl. <a href="http://msdn.microsoft.com/en-us/library/aa384642(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/aa384642(v=vs.85).aspx</a>). Es handelt sich hierbei um eine Implementierung der Web Based Enterprise Management-Spezifikation. Die Spezifikation enthält eine Menge von Funktionen zum Administrieren und zur Fernwartung von Computern, wobei sie Hardware und Betriebssystem unabhängig ist. WMI lässt sich auch lokal auf dem Computer verwenden, das auslesen der PID des Vaterprozesses sieht wie folgt aus:</p><blockquote><p>var process = FindProcess();<br>var query = string.Format(&ldquo;SELECT ParentProcessId FROM Win32_Process WHERE ProcessId = {0}&rdquo;, process.Id);<br>using (var mos = new ManagementObjectSearcher(query))<br>{<br>    var enumerator = mos.Get().GetEnumerator();<br>    if(enumerator.MoveNext())<br>    {<br>        int pid = (int)((uint)enumerator.Current  <br>           [&ldquo;ParentProcessId&rdquo;]);<br>        Console.WriteLine(&ldquo;parent pid = {0}&rdquo;, pid);<br>    }<br>    else<br>        throw new InvalidOperationException(&ldquo;can&rsquo;t read <br>           parentProcessId by WMI&rdquo;);<br>}</p></blockquote><hr><ul class=pager><li class=previous><a href=/blog/post/2012-07-28-dsls-extension-methods-und-fluent-interfaces/ data-toggle=tooltip data-placement=top title="DSLs, Extension Methods und Fluent Interfaces">&larr;
Previous Post</a></li><li class=next><a href=/blog/post/2013-03-02-immutable-objects-am-beispiel-von-passwort-hantierung-in-java/ data-toggle=tooltip data-placement=top title="Immutable Objects am Beispiel von Passwort Hantierung in Java">Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=mailto:this-is@alexander-koepke.de><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/alexander-k%c3%b6pke-3222a21b7/><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/9474615/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=@koepalex@dotnet.social><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-mastodon fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; 2024<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/blog/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>