<!doctype html><html lang=de-de><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content><meta property="og:type" content="article"><meta property="og:image" content="https://www.alexander-koepke.de//koepalex.logo.gif"><meta property="twitter:image" content="https://www.alexander-koepke.de//koepalex.logo.gif"><meta name=title content="Events über Threadgrenzen"><meta property="og:title" content="Events über Threadgrenzen"><meta property="twitter:title" content="Events über Threadgrenzen"><meta name=description content="Technical articles, the Universe and the all the rest"><meta property="og:description" content="Technical articles, the Universe and the all the rest"><meta property="twitter:description" content="Technical articles, the Universe and the all the rest"><meta property="twitter:card" content="summary"><meta name=keyword content><link rel="shortcut icon" href=/img/favicon.ico><title>Events über Threadgrenzen | </title><link rel=canonical href=/post/2011-06-10-events-uber-threadgrenzen/><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.css><link rel=stylesheet href=/css/font-awesome.all.min.css><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/hux-blog.min.js></script><script src=/js/lazysizes.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=/></a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/categories/dotnet/>dotnet</a></li><li><a href=/categories/miscellaneous/>miscellaneous</a></li><li><a href=/about//>ABOUT</a></li><li><a href=/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/koepalex.logo.gif)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/dotnet title=dotnet>dotnet
</a><a class=tag href=/tags/c title=c#>c#
</a><a class=tag href=/tags/event title=event>event
</a><a class=tag href=/tags/thread title=thread>thread</a></div><h1>Events über Threadgrenzen</h1><h2 class=subheading></h2><span class=meta>Posted by
on
Friday, June 10, 2011</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>Die meisten Tools/Programme verrichten Ihre Arbeit in Threads um die Oberfläche (UI) nicht zu blockieren. Eine &ldquo;Kommunikations-Möglichkeit&rdquo; um die UI beim Eintreten von bestimmten Gegebenheiten zu benachrichtigen sind Events. Ein Event im .Net ruft seine Ziele (InvokationList) aus dem Thread auf, aus dem es &ldquo;gefeuert&rdquo; wird. UI Controls, können i.A. nur im Mainthread arbeiten. Einen Zugriff aus einen anderen Thread führt zu einer Exception. Über das Interface ISynchronizedInvoke (implementiert von allen .Net UI Controls):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#ff79c6>interface</span> <span style=color:#50fa7b>ISynchronizeInvoke</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span> <span style=color:#8be9fd>bool</span> InvokeRequired { <span style=color:#ff79c6>get</span>; }
</span></span><span style=display:flex><span> IAsyncResult BeginInvoke (Delegate method, <span style=color:#8be9fd>object</span>\[\] args);
</span></span><span style=display:flex><span> <span style=color:#8be9fd>object</span> EndInvoke(IAsyncResult result);
</span></span><span style=display:flex><span> <span style=color:#8be9fd>object</span> Invoke(Delegate method, <span style=color:#8be9fd>object</span>\[\] args);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ist es nicht nur möglich nachzufragen ob ein Threadwechsel benötigt wird, er kann damit sogar ausgeführt werden. Damit die Methode zum Senden von Events in anderen Threads wiederverwendbar ist, bietet sich eine statische Hilfemethode an die mit Generics arbeitet und das Senden eines Events mit &ldquo;normaler&rdquo; Signatur unterstützt:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#6272a4>/// &lt;summary&gt; Method sending event to right Thread &lt;/summary&gt; </span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/// &lt;typeparam name=&#34;T&#34;&gt;Event which should arise&lt;/typeparam&gt; </span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/// &lt;typeparam name=&#34;K&#34;&gt;event arguments&lt;/typeparam&gt; </span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/// &lt;typeparam name=&#34;G&#34;&gt; object which is the sender of event &lt;/typeparam&gt; </span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/// &lt;param name=&#34;eventToFire&#34;&gt;instance of T&lt;/param&gt; </span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/// &lt;param name=&#34;args&#34;&gt;instance of K&lt;/param&gt; </span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/// &lt;param name=&#34;instance&#34;&gt;instance of G&lt;/param&gt; </span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/// &lt;remarks&gt; this will arise all events with the signature</span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/// void eventname(object sender, K eventargs) </span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/// &lt;/remarks&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>static</span> <span style=color:#ff79c6>void</span> RiseEvent&lt;T, K, G\&gt;(T eventToFire, K args, G instance)
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>where</span> T : clas
</span></span><span style=display:flex><span> {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span>(eventToFire != <span style=color:#ff79c6>null</span>)
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    MethodInfo methodInfo \= <span style=color:#ff79c6>typeof</span> (T).GetMethod(<span style=color:#f1fa8c>&#34;GetInvocationList&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (methodInfo != <span style=color:#ff79c6>null</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      Delegate\[\] delegates \= methodInfo.Invoke(eventToFire, <span style=color:#ff79c6>null</span>) <span style=color:#ff79c6>as</span> Delegate\[\];
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>if</span> (delegates != <span style=color:#ff79c6>null</span>)
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>foreach</span> (Delegate del <span style=color:#ff79c6>in</span> delegates)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          ISynchronizeInvoke syncInvoke \= del.Target <span style=color:#ff79c6>as</span> ISynchronizeInvoke;
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>if</span> (syncInvoke != <span style=color:#ff79c6>null</span>)
</span></span><span style=display:flex><span> {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> (syncInvoke.InvokeRequired)
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>              syncInvoke.Invoke(del, <span style=color:#ff79c6>new</span> <span style=color:#8be9fd>object</span>\[\] { instance, args });
</span></span><span style=display:flex><span>            } <span style=color:#ff79c6>else</span> <span style=color:#6272a4>//no invoke requried so &#34;normal&#34; call delegate</span>
</span></span><span style=display:flex><span>             del.DynamicInvoke(<span style=color:#ff79c6>new</span> <span style=color:#8be9fd>object</span>\[\] { instance, args });
</span></span><span style=display:flex><span>         } <span style=color:#ff79c6>else</span> <span style=color:#6272a4>//target don&#39;t implement ISynchronizeInvoke &gt; no thread switch</span>
</span></span><span style=display:flex><span>           del.DynamicInvoke(<span style=color:#ff79c6>new</span> <span style=color:#8be9fd>object</span>\[\] { instance, args });
</span></span><span style=display:flex><span>        }<span style=color:#6272a4>//end foreach</span>
</span></span><span style=display:flex><span>      } <span style=color:#ff79c6>else</span> Debug.Fail(<span style=color:#f1fa8c>&#34;GetInvocationList don&#39;t return Delegate\[\]&#34;</span>);
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> Debug.Fail(<span style=color:#f1fa8c>&#34;generic T don&#39;t seems to be an event&#34;</span>);
</span></span><span style=display:flex><span>  } <span style=color:#ff79c6>else</span> Debug.Write(<span style=color:#f1fa8c>&#34;wan&#39;t to rise event where nobody is registered for&#34;</span>);
</span></span><span style=display:flex><span> }
</span></span></code></pre></div><p>Verwendet kann die Methode wie folgt werden:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>RiseEvent&lt;DataChanged, DataChangedEventArgs, <span style=color:#8be9fd>object</span>&gt;(<span style=color:#ff79c6>this</span>.DataChanged, <span style=color:#ff79c6>new</span> DataChangedEventArgs, <span style=color:#ff79c6>this</span>);
</span></span></code></pre></div><hr><ul class=pager><li class=previous><a href=/post/2011-06-08-tracinglogging-config-file/ data-toggle=tooltip data-placement=top title="Tracing/Logging und die Config-Datei">&larr;
Previous Post</a></li><li class=next><a href=/post/2011-06-18-wpf-richtextbox-mit-durchgestrichenden-text/ data-toggle=tooltip data-placement=top title="WPF RichTextBox mit Durchgestrichenden Text">Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=mailto:this-is@alexander-koepke.de><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/alexander-k%c3%b6pke-3222a21b7/><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/9474615/koepalex><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=@koepalex@dotnet.social><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-mastodon fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; 2024<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>